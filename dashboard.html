<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background:  hsl(170, 97%, 36%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .container {
            max-width: 600px;
            margin: 80px auto;
            background-color: white;
            border-radius: 20px;
            border: 3px solid hsl(199, 100%, 67%);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .container-title {
            color: hwb(199 5% 68%);
            font-weight: bold;
        }

        .btn-primary {
            background-color: hsl(170, 97%, 36%);
            border: none;
            border-radius: 30px;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover {
            background-color: hsl(170, 100%, 22%);
        }

        .character-container {
            position: fixed;
            bottom: 0;
            right: 0;
            margin: 10px;
            max-width: 20vw;
            z-index: 10;
            transition: transform 0.3s ease-in-out;
        }

        .character-img {
            width: 100%;
            height: auto;
            cursor: pointer;
        }

        .dialog-bubble {
            position: absolute;
            bottom: 100%;
            right: 0;
            margin-bottom: 10px;
            background-color: #fff;
            border: 2px solid #ccc;
            border-radius: 10px;
            padding: 10px;
            max-width: 250px;
            font-size: 14px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-in-out;
        }

        .character-container:hover .dialog-bubble {
            opacity: 1;
        }
    </style>
</head>

<body>
    <!-- hola aca mathi-->

    <div class="container text-center">
        <h2>¡Bienvenido!</h2>
        
        <!-- Contenedor para examen disponible -->
        <div id="examAvailable" style="display: none;">
            <p class="lead">En este sistema tendrás tres exámenes semanales, cada uno compuesto por diez preguntas. 
                Contás con un máximo de diez minutos para resolver cada examen. Las preguntas que no sean respondidas 
                antes de que finalice el tiempo no sumarán ni restarán puntos. Además, como incentivo adicional, si respondés 
                todas las preguntas y enviás el examen antes de que se agote el tiempo, el puntaje obtenido se multiplicará por 
                la cantidad de minutos y segundos que te hayan sobrado.
            </p>
            <div class="form-check my-3">
                <input class="form-check-input" type="checkbox" id="acepto">
                <label class="form-check-label" for="acepto">Acepto términos y condiciones</label>
            </div>
            <button id="startExam" class="btn btn-primary w-50">Comenzar examen</button>
        </div>
        
        <!-- Contenedor para cuando no hay examen -->
        <div id="noExamAvailable" style="display: none;">
            <div class="alert alert-info mt-4">
                <h4 class="alert-heading">No hay exámenes disponibles</h4>
                <p>En este momento no hay exámenes disponibles para realizar.</p>
                <hr>
                <p class="mb-0">Puedes ver el ranking de los mejores puntajes mientras esperas.</p>
            </div>
            <button onclick="window.location.href='ranking.html'" class="btn btn-primary w-50 mt-3">Ver Ranking</button>
        </div>
        
        <!-- Mensaje de carga -->
        <div id="loading" class="mt-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Verificando exámenes...</span>
            </div>
            <p class="mt-2">Verificando exámenes disponibles...</p>
        </div>
    </div>

    <div class="character-container">
        <img src="img/Personaje.png" alt="Personaje" class="character-img">
        <div class="dialog-bubble">
            ¡Vamos a comenzar con todo!<br>
            Recordá aceptar los términos para iniciar el examen.
        </div>
    </div>

    <script>
        // Verificar autenticación y exámenes disponibles al cargar
        document.addEventListener('DOMContentLoaded', async function() {
            const dni = localStorage.getItem('dni');
            
            if (!dni) {
                alert('Debes iniciar sesión para acceder al dashboard');
                window.location.href = 'login.html';
                return;
            }
            
            // Verificar si hay exámenes disponibles
            try {
                const response = await fetch('https://tpfinal.store/api/exams', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'dni': dni
                    }
                });
                
                const data = await response.json();
                console.log('Exámenes disponibles:', data);
                
                // Ocultar el mensaje de carga
                document.getElementById('loading').style.display = 'none';
                
                // Verificar si hay exámenes disponibles
                if (data && data.exams && data.exams.length > 0) {
                    // Hay exámenes disponibles
                    document.getElementById('examAvailable').style.display = 'block';
                    document.getElementById('noExamAvailable').style.display = 'none';
                    
                    // Guardar el ID del primer examen disponible
                    const examId = data.exams[0].id;
                    localStorage.setItem('currentExamId', examId);
                    console.log('Examen ID guardado:', examId);
                } else {
                    // No hay exámenes disponibles
                    document.getElementById('examAvailable').style.display = 'none';
                    document.getElementById('noExamAvailable').style.display = 'block';
                }
                
            } catch (error) {
                console.error('Error al verificar exámenes:', error);
                // En caso de error, ocultar carga y mostrar que no hay exámenes
                document.getElementById('loading').style.display = 'none';
                document.getElementById('examAvailable').style.display = 'none';
                document.getElementById('noExamAvailable').style.display = 'block';
            }
        });

        // Manejar click del botón de examen
        document.getElementById('startExam').addEventListener('click', function() {
            const checkbox = document.getElementById('acepto');
            
            if (!checkbox.checked) {
                alert('Debes aceptar los términos y condiciones para continuar');
                return;
            }
            
            window.location.href = 'exam.html';
        });
    </script>
</body>

</html>